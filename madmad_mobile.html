<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mad Max: Apocalipsis Climático</title>
    <style>
        /* Estilos generales post-apocalípticos */
        @import url('https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Orbitron:wght@400;700&family=Press+Start+2P&display=swap');
        
        :root {
            --rust: #b7410e;
            --neon-orange: #ff5e00;
            --dark-metal: #2a2a2a;
            --dirty-yellow: #e6d800;
            --wasteland-sand: #c2b280;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        
        body {
            font-family: 'Orbitron', sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(183, 65, 14, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 94, 0, 0.1) 0%, transparent 20%),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="none" stroke="%23b7410e" stroke-width="0.5"/></svg>');
            line-height: 1.6;
            overflow-x: hidden;
            touch-action: manipulation;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
            padding-top: 70px; /* Espacio para el temporizador fijo */
        }
        
        /* Efecto de título oxidado */
        .title {
            font-family: 'Black Ops One', cursive;
            text-align: center;
            margin: 20px 0;
            position: relative;
            font-size: 2.2rem;
            color: var(--neon-orange);
            text-shadow: 
                0 0 5px var(--rust),
                0 0 10px var(--rust),
                2px 2px 0px var(--dark-metal),
                4px 4px 0px rgba(0, 0, 0, 0.5);
            letter-spacing: 1px;
            animation: flicker 3s infinite alternate;
        }
        
        .title::after {
            content: "";
            position: absolute;
            bottom: -8px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--rust), transparent);
            border-radius: 50%;
            filter: blur(1px);
        }
        
        @keyframes flicker {
            0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {
                text-shadow: 
                    0 0 5px var(--rust),
                    0 0 10px var(--rust),
                    2px 2px 0px var(--dark-metal),
                    4px 4px 0px rgba(0, 0, 0, 0.5);
            }
            20%, 24%, 55% {
                text-shadow: 
                    0 0 10px var(--rust),
                    0 0 20px var(--rust),
                    2px 2px 0px var(--dark-metal),
                    4px 4px 0px rgba(0, 0, 0, 0.5),
                    0 0 30px var(--neon-orange);
            }
        }
        
        /* Pantalla de inicio */
        .start-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            min-height: 100vh;
        }
        
        .start-title {
            color: var(--neon-orange);
            font-size: 2rem;
            margin-bottom: 20px;
            text-shadow: 0 0 10px var(--neon-orange);
        }
        
        .start-message {
            background-color: rgba(10, 10, 10, 0.95);
            border: 2px solid var(--neon-orange);
            border-radius: 5px;
            padding: 15px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            font-weight: 400;
            color: #ffffff;
            line-height: 1.6;
            letter-spacing: 0.5px;
            max-width: 100%;
            margin: 20px auto;
            text-align: justify;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 20px rgba(255, 94, 0, 0.3);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-y: auto;
            max-height: 60vh;
        }
        
        .start-message p {
            margin-bottom: 15px;
        }
        
        .start-message p:last-child {
            margin-bottom: 0;
        }
        
        .start-message::before {
            content: "";
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border-radius: 8px;
            background: linear-gradient(45deg, 
                        var(--neon-orange), 
                        transparent, 
                        var(--neon-orange));
            z-index: -1;
            opacity: 0.7;
            animation: borderGlow 3s infinite alternate;
        }
        
        @keyframes borderGlow {
            from { opacity: 0.3; }
            to { opacity: 0.7; }
        }
        
        .start-btn {
            background-color: var(--rust);
            color: white;
            border: none;
            padding: 15px 30px;
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            border-radius: 3px;
            transition: all 0.3s;
            font-size: 1.2rem;
            margin-top: 20px;
            min-width: 200px;
            min-height: 50px;
        }
        
        .start-btn:active {
            background-color: var(--neon-orange);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 94, 0, 0.5);
        }
        
        /* Panel de juego */
        .game-panel {
            background-color: rgba(42, 42, 42, 0.8);
            border: 3px solid var(--rust);
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            position: relative;
            box-shadow: 
                0 0 10px rgba(183, 65, 14, 0.5),
                inset 0 0 20px rgba(0, 0, 0, 0.5);
            display: none;
        }
        
        .game-panel::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(135deg, rgba(183, 65, 14, 0.1) 0%, transparent 50%),
                linear-gradient(-135deg, rgba(255, 94, 0, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        /* Temporizador */
        .timer {
            font-family: 'Press Start 2P', cursive;
            font-size: 1.2rem;
            color: var(--neon-orange);
            text-align: center;
            padding: 8px;
            background-color: rgba(0, 0, 0, 0.7);
            border: 2px solid var(--rust);
            border-radius: 5px;
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            animation: pulse 2s infinite;
            display: none;
            width: 90%;
            max-width: 200px;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 5px var(--neon-orange); }
            50% { box-shadow: 0 0 20px var(--neon-orange); }
            100% { box-shadow: 0 0 5px var(--neon-orange); }
        }
        
        /* Narración */
        .narrative {
            background-color: rgba(0, 0, 0, 0.7);
            border-left: 5px solid var(--neon-orange);
            padding: 12px;
            margin: 15px 0;
            font-style: italic;
            position: relative;
            font-size: 0.9rem;
        }
        
        .narrative::before {
            content: "⚡";
            position: absolute;
            left: -15px;
            top: -10px;
            font-size: 1.2rem;
            color: var(--neon-orange);
        }
        
        /* Retos */
        .challenge {
            display: none;
            animation: fadeIn 1s;
        }
        
        .challenge.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .challenge-title {
            color: var(--neon-orange);
            border-bottom: 2px solid var(--rust);
            padding-bottom: 8px;
            margin-bottom: 15px;
            font-size: 1.5rem;
            text-shadow: 1px 1px 1px #000;
            text-align: center;
        }
        
        /* Reto 1: Libros - Adaptado para móvil */
        .books-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            overflow: visible;
        }
        
        .bookshelf {
            background-color: #3a2a1a;
            border: 3px solid #5a4a3a;
            height: 180px;
            display: flex;
            padding: 10px;
            gap: 10px;
            position: relative;
            margin-bottom: 50px;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
        }
        
        .bookshelf::-webkit-scrollbar {
            height: 5px;
        }
        
        .bookshelf::-webkit-scrollbar-thumb {
            background: var(--rust);
            border-radius: 5px;
        }
        
        .bookshelf::before {
            content: "";
            position: absolute;
            top: -10px;
            left: 0;
            right: 0;
            height: 10px;
            background-color: #5a4a3a;
            border-radius: 5px 5px 0 0;
        }
        
        .bookshelf::after {
            content: "";
            position: absolute;
            bottom: -30px;
            left: 0;
            right: 0;
            height: 10px;
            background-color: #5a4a3a;
            border-radius: 0 0 5px 5px;
        }
        
        .shelf-slot {
            flex: 0 0 100px;
            background-color: rgba(90, 74, 58, 0.3);
            border: 2px dashed rgba(255, 94, 0, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8rem;
            text-transform: uppercase;
            position: relative;
            z-index: 2;
            bottom: -35px;
            scroll-snap-align: start;
        }
        
        .shelf-slot::after {
            content: attr(data-layer);
            position: absolute;
            bottom: -25px;
            left: 0;
            right: 0;
            text-align: center;
            color: var(--neon-orange);
            font-size: 0.9rem;
            font-weight: bold;
            text-shadow: 0 0 5px var(--rust);
            background-color: rgba(0,0,0,0.7);
            padding: 3px;
            border-radius: 3px;
        }
        
        .book {
            background-color: #1a1a2a;
            border: 2px solid var(--rust);
            padding: 8px;
            width: 80px;
            height: 120px;
            cursor: pointer;
            position: relative;
            transition: transform 0.2s;
            user-select: none;
            box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.5);
            touch-action: none;
        }
        
        .book:active {
            transform: scale(1.1);
            box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.7);
            z-index: 10;
        }
        
        .book-title {
            font-size: 0.8rem;
            font-weight: bold;
            color: var(--neon-orange);
            writing-mode: vertical-rl;
            text-orientation: mixed;
            transform: rotate(180deg);
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 1px 1px 1px #000;
        }
        
        .book-spine {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background-color: var(--rust);
        }
        
        .books-to-sort {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 15px;
            background-color: rgba(42, 42, 42, 0.5);
            border: 2px solid var(--rust);
            border-radius: 5px;
            min-height: 150px;
            justify-content: center;
        }
        
        /* Instrucciones para el reto de libros */
        .books-instructions {
            background-color: rgba(0, 0, 0, 0.7);
            border-left: 3px solid var(--neon-orange);
            padding: 10px;
            margin: 10px 0;
            font-size: 0.9rem;
        }
        .btn + .btn {
    margin-left: 10px;
}

@media (max-width: 480px) {
    #checkBooks, #resetBooks {
        width: 100%;
        margin-left: 0;
        margin-top: 10px;
    }
}
        /* Reto 2: Quiz - Adaptado para móvil */
        .quiz-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        .quiz-item {
            background-color: rgba(42, 42, 42, 0.7);
            border: 1px solid var(--rust);
            padding: 12px;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .quiz-item::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background-color: var(--rust);
        }
        
        .quiz-question {
            font-weight: bold;
            color: var(--wasteland-sand);
            font-size: 1rem;
        }
        
        .quiz-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .quiz-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            min-height: 24px;
        }
        
        .quiz-option input {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid var(--rust);
            border-radius: 50%;
            position: relative;
            cursor: pointer;
        }
        
        .quiz-option input:checked::after {
            content: "";
            position: absolute;
            top: 3px;
            left: 3px;
            width: 10px;
            height: 10px;
            background-color: var(--neon-orange);
            border-radius: 50%;
        }
        
        /* Reto 3: Hábitos - Adaptado para móvil */
        .habits-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-bottom: 60px; /* Espacio para la barra de CO2 fija */
        }
        
        .habit-item {
            background-color: rgba(42, 42, 42, 0.7);
            border: 1px solid var(--rust);
            padding: 12px;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .habit-item:active {
            background-color: rgba(183, 65, 14, 0.2);
            transform: translateY(-3px);
        }
        
        .habit-item.selected {
            background-color: rgba(0, 100, 0, 0.3);
            border-color: #00aa00;
        }
        
        .habit-item.selected .habit-title {
            color: #00ff00;
        }
        
        .habit-title {
            font-weight: bold;
            color: var(--wasteland-sand);
            font-size: 1rem;
        }
        
        .habit-impact {
            font-size: 0.9rem;
            color: var(--neon-orange);
            position: absolute;
            right: 10px;
            top: 10px;
            background: rgba(0,0,0,0.7);
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        /* Barra de CO2 fija en móvil */
        .carbon-meter-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.9);
            padding: 10px;
            z-index: 50;
            border-top: 2px solid var(--neon-orange);
        }
        
        .carbon-meter {
            width: 100%;
            height: 30px;
            background-color: #333;
            border: 2px solid var(--rust);
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }
        
        .carbon-level {
            height: 100%;
            background: linear-gradient(90deg, #00aa00, #ff5e00);
            width: 100%;
            transition: width 0.5s;
        }
        
        .carbon-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 1px #000;
            font-size: 0.9rem;
        }
        
        /* Reto 4: Circuito - Adaptado para móvil */
        .circuit-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .energy-source {
            background-color: rgba(42, 42, 42, 0.7);
            border: 3px solid var(--rust);
            border-radius: 5px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .energy-source::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background-color: var(--rust);
        }
        
        .energy-source:active {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(255, 94, 0, 0.3);
        }
        
        .energy-source.active {
            border-color: #00ff00;
            background-color: rgba(0, 100, 0, 0.3);
        }
        
        .energy-source.active::before {
            background-color: #00ff00;
        }
        
        .energy-icon {
            font-size: 2rem;
        }
        
        .energy-name {
            font-weight: bold;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .energy-status {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .energy-source.active .energy-status {
            color: #00ff00;
        }
        
        /* Panel de conexiones */
        .circuit-board {
            background-color: #1a1a1a;
            border: 3px solid var(--rust);
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            position: relative;
            min-height: 150px;
        }
        
        .circuit-board::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(255, 94, 0, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 94, 0, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            pointer-events: none;
        }
        
        .circuit-node {
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: var(--neon-orange);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        
        .circuit-line {
            position: absolute;
            height: 2px;
            background-color: var(--neon-orange);
            transform-origin: left center;
            z-index: 1;
        }
        
        /* Estilo para los nodos activos */
        .circuit-node.active {
            background-color: #00ff00;
            box-shadow: 0 0 15px #00ff00;
            animation: pulseGreen 0.5s infinite alternate;
        }
        
        @keyframes pulseGreen {
            from { box-shadow: 0 0 5px #00ff00; }
            to { box-shadow: 0 0 20px #00ff00; }
        }
        
        /* Botones */
        .btn {
            background-color: var(--rust);
            color: white;
            border: none;
            padding: 12px 20px;
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            border-radius: 3px;
            transition: all 0.3s;
            margin-top: 15px;
            display: inline-block;
            min-width: 160px;
            min-height: 45px;
            font-size: 0.9rem;
        }
        
        .btn:active {
            background-color: var(--neon-orange);
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(255, 94, 0, 0.3);
        }
        
        .btn:disabled {
            background-color: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* Modal final */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.5s;
            padding: 15px;
        }
        
        .modal-content {
            background-color: var(--dark-metal);
            border: 3px solid var(--neon-orange);
            border-radius: 5px;
            padding: 20px;
            width: 100%;
            max-width: 400px;
            text-align: center;
            position: relative;
            box-shadow: 0 0 30px var(--neon-orange);
        }
        
        .modal-title {
            color: var(--neon-orange);
            font-size: 1.8rem;
            margin-bottom: 15px;
            text-shadow: 0 0 10px var(--neon-orange);
        }
        
        .modal-message {
            margin-bottom: 20px;
            font-size: 1rem;
        }
        
        .code-input {
            background-color: #000;
            color: var(--neon-orange);
            border: 2px solid var(--neon-orange);
            font-family: 'Press Start 2P', cursive;
            font-size: 1.2rem;
            padding: 10px;
            text-align: center;
            width: 100%;
            margin-bottom: 15px;
            letter-spacing: 3px;
        }
        
        .code-input::placeholder {
            color: rgba(255, 94, 0, 0.5);
        }
        
        /* Pantalla final del juego */
        .final-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            animation: fadeIn 2s;
            min-height: 100vh;
        }
        
        .final-title {
            color: var(--neon-orange);
            font-size: 2rem;
            margin-bottom: 20px;
            text-shadow: 0 0 20px var(--neon-orange);
        }
        
        .final-message {
            font-size: 1.1rem;
            margin-bottom: 20px;
            max-width: 100%;
            line-height: 1.6;
        }
        
        .resources {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .resource-link {
            background-color: var(--rust);
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            text-decoration: none;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .resource-link:active {
            background-color: var(--neon-orange);
            transform: translateY(-3px);
        }
        
        /* Efectos de terminal */
        .terminal-effect {
            position: relative;
        }
        
        .terminal-effect::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(rgba(0, 255, 0, 0.1) 50%, 
                transparent 50%);
            background-size: 100% 4px;
            pointer-events: none;
            animation: scanline 5s linear infinite;
        }
        
        @keyframes scanline {
            0% { background-position: 0 0; }
            100% { background-position: 0 100%; }
        }
        
        /* Pantalla de código discreta */
        .code-popup {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid var(--neon-orange);
            border-radius: 8px;
            padding: 12px;
            z-index: 1000;
            font-family: 'Press Start 2P', cursive;
            color: var(--neon-orange);
            text-align: center;
            max-width: 180px;
            box-shadow: 0 0 15px rgba(255, 94, 0, 0.5);
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        .code-popup h3 {
            font-size: 0.8rem;
            margin-bottom: 8px;
            text-shadow: 0 0 5px var(--neon-orange);
        }
        
        .code-popup .code {
            font-size: 1.5rem;
            letter-spacing: 2px;
            margin: 8px 0;
            text-shadow: 0 0 10px var(--neon-orange);
        }
        
        .code-popup .hint {
            color: var(--wasteland-sand);
            font-size: 0.6rem;
            line-height: 1.4;
        }
        
        /* Overlay de audio */
        #audioOverlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            color: orange;
            text-align: center;
            padding-top: 50px;
            z-index: 1000;
        }
        
        #audioOverlay p {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        /* Instrucciones para cada reto */
        .instructions-btn {
            background-color: rgba(0,0,0,0.5);
            border: 1px solid var(--neon-orange);
            color: var(--neon-orange);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 50;
            font-weight: bold;
            cursor: pointer;
        }
        
        .instructions-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .instructions-content {
            background: var(--dark-metal);
            border: 2px solid var(--neon-orange);
            border-radius: 5px;
            padding: 15px;
            max-width: 500px;
            margin: 20px auto;
        }
        
        .instructions-title {
            color: var(--neon-orange);
            margin-bottom: 15px;
            text-align: center;
        }
        
        .instructions-text {
            margin-bottom: 15px;
        }
        
        .close-instructions {
            background: var(--rust);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 3px;
            margin-top: 10px;
            cursor: pointer;
        }
        
        /* Animaciones optimizadas para móvil */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Pantalla de inicio -->
    <div class="start-screen" id="startScreen">
        <h1 class="title">MAD MAX: APOCALIPSIS CLIMÁTICO</h1>
        
        <div class="start-message terminal-effect">
            <p><strong>Año 2050.</strong> El mundo que conocíais ha desaparecido. Las tormentas de arena arrasaron las ciudades y la Tierra se ha convertido en un páramo, un desierto donde el agua es más valiosa que la gasolina y la atmósfera está al borde del colapso.</p>
            <p>Sois algunos de los últimos científicos de la Resistencia y habéis encontrado en mitad del desierto el laboratorio del Dr. Atmos que, según los rumores, tenía la clave para revertir la situación antes de ser asesinado por Immortal Joe.</p>
            <p>Con la ayuda de Max y Furiosa, debéis descifrar sus archivos antes de que una tormenta de arena destruya el laboratorio. Solo tienes 30 minutos para encontrar la solución y salvar lo que queda de la humanidad.</p>
            <p>¿Podrás descifrar los misterios de la atmósfera y desbloquear el dispositivo secreto del Dr. Atmos?</p>
        </div>
        
        <button class="start-btn" id="startBtn">INICIAR MISIÓN</button>
    </div>
    
    <!-- Juego principal (oculto al inicio) -->
    <div class="container">
        <div class="timer" id="timer">30:00</div>
        
        <div class="game-panel" id="gamePanel">
            <div class="narrative terminal-effect">
                <p>El laboratorio del Dr. Atmos está lleno de tecnología antigua y documentos sobre la atmósfera terrestre. Una tormenta de arena se acerca. ¡Debes darte prisa!</p>
            </div>
            
            <!-- Reto 1: Archivos Atmosféricos -->
            <div class="challenge active" id="challenge1">
                <h2 class="challenge-title">ARCHIVOS ATMOSFÉRICOS</h2>
                <button class="btn" id="resetBooks" style="margin-left: 10px;">REINICIAR LIBROS</button>
                <div class="books-instructions">
                    <p><strong>Instrucciones:</strong> Ordena los libros según las capas de la atmósfera, de más cercana a más lejana de la superficie terrestre: <strong>Troposfera → Estratosfera → Mesosfera → Termosfera → Exosfera</strong>.</p>
                    <p>Toca un libro y luego toca el estante donde quieres colocarlo. Toca un libro colocado para devolverlo a su lugar original.</p>
                </div>
                <div class="books-container">
                    <div class="bookshelf">
                        <div class="shelf-slot" data-layer="TROPOSFERA" id="slot1"></div>
                        <div class="shelf-slot" data-layer="ESTRATOSFERA" id="slot2"></div>
                        <div class="shelf-slot" data-layer="MESOSFERA" id="slot3"></div>
                        <div class="shelf-slot" data-layer="TERMOSFERA" id="slot4"></div>
                        <div class="shelf-slot" data-layer="EXOSFERA" id="slot5"></div>
                    </div>
                    
                    <div class="books-to-sort" id="booksToSort">
                        <div class="book" draggable="false" data-layer="troposfera" id="book1">
                            <div class="book-spine"></div>
                            <div class="book-title">Sequía y DANA: Síntomas extremos</div>
                        </div>
                        <div class="book" draggable="false" data-layer="exosfera" id="book2">
                            <div class="book-spine"></div>
                            <div class="book-title">Frontera Final: La caída de los satélites</div>
                        </div>
                        <div class="book" draggable="false" data-layer="mesosfera" id="book3">
                            <div class="book-spine"></div>
                            <div class="book-title">Meteoros y Cenizas</div>
                        </div>
                        <div class="book" draggable="false" data-layer="estratosfera" id="book4">
                            <div class="book-spine"></div>
                            <div class="book-title">El Escudo Invisible: La capa de ozono</div>
                        </div>
                        <div class="book" draggable="false" data-layer="termosfera" id="book5">
                            <div class="book-spine"></div>
                            <div class="book-title">Luces polares, auroras boreales</div>
                        </div>
                    </div>
                </div>
                
                <button class="btn" id="checkBooks">VERIFICAR ORDEN</button>
            </div>
            
            <!-- Reto 2: Mitos del Wasteland -->
            <div class="challenge" id="challenge2">
                <h2 class="challenge-title">MITOS DEL WASTELAND</h2>
                <div class="books-instructions">
                    <p><strong>Instrucciones:</strong> Identifica qué afirmaciones son realidades científicas sobre el cambio climático y cuáles son mitos. Selecciona "Mito" o "Realidad" para cada pregunta.</p>
                </div>
                
                <div class="quiz-container terminal-effect">
                    <div class="quiz-item">
                        <div class="quiz-question">Los volcanes emiten más CO₂ que las actividades humanas.</div>
                        <div class="quiz-options">
                            <label class="quiz-option">
                                <input type="radio" name="q1" value="mito">
                                <span>Mito</span>
                            </label>
                            <label class="quiz-option">
                                <input type="radio" name="q1" value="realidad">
                                <span>Realidad</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="quiz-item">
                        <div class="quiz-question">El aumento de temperatura global está causando la acidificación de los océanos.</div>
                        <div class="quiz-options">
                            <label class="quiz-option">
                                <input type="radio" name="q2" value="mito">
                                <span>Mito</span>
                            </label>
                            <label class="quiz-option">
                                <input type="radio" name="q2" value="realidad">
                                <span>Realidad</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="quiz-item">
                        <div class="quiz-question">El cambio climático solo afecta a las temperaturas, no a los patrones de precipitación.</div>
                        <div class="quiz-options">
                            <label class="quiz-option">
                                <input type="radio" name="q3" value="mito">
                                <span>Mito</span>
                            </label>
                            <label class="quiz-option">
                                <input type="radio" name="q3" value="realidad">
                                <span>Realidad</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="quiz-item">
                        <div class="quiz-question">El permafrost del Ártico contiene grandes cantidades de metano que podrían liberarse con el calentamiento.</div>
                        <div class="quiz-options">
                            <label class="quiz-option">
                                <input type="radio" name="q4" value="mito">
                                <span>Mito</span>
                            </label>
                            <label class="quiz-option">
                                <input type="radio" name="q4" value="realidad">
                                <span>Realidad</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="quiz-item">
                        <div class="quiz-question">El cambio climático es un proceso natural que siempre ha ocurrido, por lo que no debemos preocuparnos.</div>
                        <div class="quiz-options">
                            <label class="quiz-option">
                                <input type="radio" name="q5" value="mito">
                                <span>Mito</span>
                            </label>
                            <label class="quiz-option">
                                <input type="radio" name="q5" value="realidad">
                                <span>Realidad</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="quiz-item">
                        <div class="quiz-question">La energía nuclear es una energía segura y barata.</div>
                        <div class="quiz-options">
                            <label class="quiz-option">
                                <input type="radio" name="q6" value="mito">
                                <span>Mito</span>
                            </label>
                            <label class="quiz-option">
                                <input type="radio" name="q6" value="realidad">
                                <span>Realidad</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="quiz-item">
                        <div class="quiz-question">La deforestación contribuye al cambio climático al reducir la capacidad de absorción de CO₂.</div>
                        <div class="quiz-options">
                            <label class="quiz-option">
                                <input type="radio" name="q7" value="mito">
                                <span>Mito</span>
                            </label>
                            <label class="quiz-option">
                                <input type="radio" name="q7" value="realidad">
                                <span>Realidad</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="quiz-item">
                        <div class="quiz-question">El aumento del nivel del mar no tiene que ver con el derretimiento de los polos.</div>
                        <div class="quiz-options">
                            <label class="quiz-option">
                                <input type="radio" name="q8" value="mito">
                                <span>Mito</span>
                            </label>
                            <label class="quiz-option">
                                <input type="radio" name="q8" value="realidad">
                                <span>Realidad</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <button class="btn" id="checkQuiz">VERIFICAR RESPUESTAS</button>
            </div>
            
            <!-- Reto 3: El Libro de los Hábitos -->
            <div class="challenge" id="challenge3">
                <h2 class="challenge-title">EL LIBRO DE LOS HÁBITOS</h2>
                <div class="books-instructions">
                    <p><strong>Instrucciones:</strong> Selecciona los hábitos sostenibles para reducir la huella de carbono por debajo de 30 kg/día. Cada hábito muestra su impacto en kg de CO₂.</p>
                    <p>La barra de CO₂ permanece visible en la parte inferior mientras navegas por los hábitos.</p>
                </div>
                
                <div class="habits-container">
                    <!-- ACTIVIDADES MEZCLADAS - IMPACTO DE HUELLA DE CARBONO -->
                    <div class="habit-item" data-impact="-2.50">
                        <div class="habit-title">Cambiar a dieta vegana</div>
                    </div>

                    <div class="habit-item" data-impact="+7.20">
                        <div class="habit-title">Comer carne roja a diario</div>
                    </div>

                    <div class="habit-item" data-impact="-3.20">
                        <div class="habit-title">Usar transporte público</div>
                    </div>

                    <div class="habit-item" data-impact="+100.00">
                        <div class="habit-title">Vuelo internacional</div>
                    </div>

                    <div class="habit-item" data-impact="-10.00">
                        <div class="habit-title">Instalar paneles solares en casa</div>
                    </div>

                    <div class="habit-item" data-impact="+6.80">
                        <div class="habit-title">Usar coche a gasolina</div>
                    </div>

                    <div class="habit-item" data-impact="-1.80">
                        <div class="habit-title">Secar ropa al aire libre</div>
                    </div>

                    <div class="habit-item" data-impact="+4.50">
                        <div class="habit-title">Aire acondicionado a 18°C</div>
                    </div>

                    <div class="habit-item" data-impact="-4.50">
                        <div class="habit-title">Teletrabajar 3 días/semana</div>
                    </div>

                    <div class="habit-item" data-impact="+15.00">
                        <div class="habit-title">Comprar ropa de mala calidad en tiendas baratas</div>
                    </div>

                    <div class="habit-item" data-impact="-1.50">
                        <div class="habit-title">Comprar alimentos locales</div>
                    </div>

                    <div class="habit-item" data-impact="+1.50">
                        <div class="habit-title">Dejar dispositivos en standby</div>
                    </div>

                    <div class="habit-item" data-impact="-3.20">
                        <div class="habit-title">Reciclar plástico/metal</div>
                    </div>

                    <div class="habit-item" data-impact="+1.20">
                        <div class="habit-title">Comprar agua embotellada</div>
                    </div>

                    <div class="habit-item" data-impact="-1.50">
                        <div class="habit-title">Usar termostato programable</div>
                    </div>

                    <div class="habit-item" data-impact="-4.00">
                        <div class="habit-title">Ir al instituto en bicicleta</div>
                    </div>

                    <div class="habit-item" data-impact="-3.10">
                        <div class="habit-title">Reducir carne roja</div>
                    </div>

                    <div class="habit-item" data-impact="-2.60">
                        <div class="habit-title">Compostar residuos orgánicos</div>
                    </div>

                    <div class="habit-item" data-impact="-1.00">
                        <div class="habit-title">Usar LED en toda la casa</div>
                    </div>

                    <div class="habit-item" data-impact="-25.00">
                        <div class="habit-title">Evitar vuelos cortos</div>
                    </div>

                    <div class="habit-item" data-impact="-5.00">
                        <div class="habit-title">Elegir energía verde certificada</div>
                    </div>

                    <div class="habit-item" data-impact="-2.00">
                        <div class="habit-title">Reparar electrodomésticos</div>
                    </div>

                    <div class="habit-item" data-impact="-3.00">
                        <div class="habit-title">Usar ropa hasta que se desgaste</div>
                    </div>

                    <div class="habit-item" data-impact="+10.00">
                        <div class="habit-title">Comprar smartphone nuevo cada año</div>
                    </div>

                    <div class="habit-item" data-impact="-7.00">
                        <div class="habit-title">Viajar en tren en vez de en avión</div>
                    </div>   
                </div>
                
                <!-- Barra de CO2 fija en móvil -->
                <div class="carbon-meter-container">
                    <div class="carbon-meter">
                        <div class="carbon-level" id="carbonLevel"></div>
                        <div class="carbon-label" id="carbonLabel">100 kg CO₂/día</div>
                    </div>
                    <button class="btn" id="checkHabits">VERIFICAR HÁBITOS</button>
                </div>
            </div>
            
            <!-- Reto 4: El Circuito de Furiosa -->
            <div class="challenge" id="challenge4">
                <h2 class="challenge-title">EL CIRCUITO DE FURIOSA</h2>
                <div class="books-instructions">
                    <p><strong>Instrucciones:</strong> Conecta solo las fuentes de energía sostenibles para activar el sistema. Toca cada fuente para activarla/desactivarla.</p>
                    <p>Las fuentes sostenibles son: solar, eólica, hidroeléctrica, geotérmica y mareomotriz.</p>
                </div>
                
                <div class="circuit-container">
                    <div class="energy-source" data-type="sostenible">
                        <div class="energy-icon">☀️</div>
                        <div class="energy-name">Panel Solar</div>
                        <div class="energy-status">DESACTIVADO</div>
                    </div>
                    
                    <div class="energy-source" data-type="contaminante">
                        <div class="energy-icon">⛽</div>
                        <div class="energy-name">Motor Diésel</div>
                        <div class="energy-status">DESACTIVADO</div>
                    </div>
                    
                    <div class="energy-source" data-type="sostenible">
                        <div class="energy-icon">🌬️</div>
                        <div class="energy-name">Turbina Eólica</div>
                        <div class="energy-status">DESACTIVADO</div>
                    </div>
                    
                    <div class="energy-source" data-type="contaminante">
                        <div class="energy-icon">🛢️</div>
                        <div class="energy-name">Planta de Carbón</div>
                        <div class="energy-status">DESACTIVADO</div>
                    </div>
                    
                    <div class="energy-source" data-type="sostenible">
                        <div class="energy-icon">💧</div>
                        <div class="energy-name">Energía Hidroeléctrica</div>
                        <div class="energy-status">DESACTIVADO</div>
                    </div>
                    
                    <div class="energy-source" data-type="contaminante">
                        <div class="energy-icon">🔥</div>
                        <div class="energy-name">Incineradora</div>
                        <div class="energy-status">DESACTIVADO</div>
                    </div>

                    <div class="energy-source" data-type="sostenible">
                        <div class="energy-icon">🌋</div>
                        <div class="energy-name">Energía Geotérmica</div>
                        <div class="energy-status">DESACTIVADO</div>
                    </div>

                    <div class="energy-source" data-type="contaminante">
                        <div class="energy-icon">☢️</div>
                        <div class="energy-name">Nuclear</div>
                        <div class="energy-status">DESACTIVADO</div>
                    </div>

                    <div class="energy-source" data-type="sostenible">
                        <div class="energy-icon">🌊</div>
                        <div class="energy-name">Mareomotriz</div>
                        <div class="energy-status">DESACTIVADO</div>
                    </div>
                </div>
                
                <div class="circuit-board" id="circuitBoard">
                    <!-- Circuito se generará con JavaScript -->
                </div>
                
                <button class="btn" id="checkCircuit">ACTIVAR CIRCUITO</button>
            </div>
            
            <!-- Panel final para introducir código -->
            <div class="modal" id="codeModal">
                <div class="modal-content terminal-effect">
                    <h2 class="modal-title">CÓDIGO DE ACCESO</h2>
                    <p class="modal-message">¡Has reunido todas las partes del código! Introduce la palabra clave para activar el dispositivo del Dr. Atmos.</p>
                    <p class="modal-message">Pistas obtenidas: <span id="codeParts" style="color: var(--neon-orange); font-weight: bold;"></span></p>
                    <input type="text" class="code-input" id="finalCode" placeholder="ENTER CODE" maxlength="8">
                    <button class="btn" id="submitCode">ACTIVAR DISPOSITIVO</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Pantalla final del juego -->
    <div class="final-screen" id="finalScreen">
        <h2 class="final-title">¡HAS VUELTO A 2025!</h2>
        <p class="final-message">El dispositivo del Dr. Atmos era una máquina del tiempo. Has viajado al pasado, cuando aún hay tiempo para evitar el apocalipsis climático. ¡La solución está en actuar HOY!</p>
        <p class="final-message">VALHALLA no es un lugar, es un futuro que podemos construir juntos con acciones sostenibles.</p>
               
        <div class="resources">
            <a href="https://climate.nasa.gov" class="resource-link" target="_blank">NASA: Cambio Climático</a>
            <a href="https://www.who.int/es/news-room/fact-sheets/detail/climate-change-and-health" class="resource-link" target="_blank">OMS: Cambio Climático y Salud</a>
            <a href="https://www.un.org/es/climatechange" class="resource-link" target="_blank">ONU: Acción por el Clima</a>
            <a href="https://www.eea.europa.eu/es/themes/climate" class="resource-link" target="_blank">Agencia Europea del Medio Ambiente</a>
            <a href="https://www.nationalgeographic.es/search?q=cambio+climatico" class="resource-link" target="_blank">National Geographic: Cambio Climático</a>
        </div>
    </div>

    <!-- Overlay de audio -->
    <div id="audioOverlay">
        <p>¡Toca el botón para activar el audio!</p>
        <button class="btn" id="activateAudio">ACTIVAR SONIDO</button>
    </div>

    <!-- Botón de instrucciones -->
    <div class="instructions-btn" id="instructionsBtn">?</div>
    
    <!-- Panel de instrucciones -->
    <div class="instructions-panel" id="instructionsPanel">
        <div class="instructions-content">
            <h3 class="instructions-title" id="instructionsTitle">INSTRUCCIONES</h3>
            <div class="instructions-text" id="instructionsText">
                <p>Bienvenido a Mad Max: Apocalipsis Climático. Tu misión es completar los 4 retos para obtener el código final y salvar el mundo.</p>
                <p>Cada reto te dará una parte del código. Al completar los 4 retos, podrás introducir el código final.</p>
                <p>¡Tienes 30 minutos para completar la misión!</p>
            </div>
            <button class="close-instructions" id="closeInstructions">CERRAR</button>
        </div>
    </div>

    <!-- Pantalla temporal para mostrar códigos -->
    <div id="codePopup" class="code-popup" style="display: none;">
        <h3>CÓDIGO OBTENIDO</h3>
        <div id="currentCode" class="code"></div>
        <div class="hint">(Anota este código)</div>
    </div>

    <script>
        // Variables globales
        let timeLeft = 30 * 60; // 30 minutos en segundos
        let timerInterval;
        let currentChallenge = 1;
        let codeParts = [];
        let selectedBook = null;
        let lastTap = 0;
        
        // Respuestas correctas para los retos
        const correctAnswers = {
            books: ["troposfera", "estratosfera", "mesosfera", "termosfera", "exosfera"],
            quiz: ["mito", "realidad", "mito", "realidad", "mito", "mito", "realidad", "mito"],
            carbonTarget: 30,
            circuit: ["sostenible", "sostenible", "sostenible", "sostenible", "sostenible"]
        };
        
        // Sonidos
        const sounds = {
            engine: null,
            explosion: null,
            radio: null,
            success: null
        };
        
        // Inicializar el juego
        function initGame() {
            // Configurar pantalla de inicio
            document.getElementById('startBtn').addEventListener('click', startGame);
            
            // Configurar eventos de los retos
            setupChallenge1();
            setupChallenge2();
            setupChallenge3();
            setupChallenge4();
            
            // Generar circuito
            generateCircuit();
            
            // Configurar eventos del modal final
            document.getElementById('submitCode').addEventListener('click', checkFinalCode);
            
            // Configurar audio overlay
            document.getElementById('activateAudio').addEventListener('click', activateAudio);
            
            // Configurar botón de instrucciones
            document.getElementById('instructionsBtn').addEventListener('click', showInstructions);
            document.getElementById('closeInstructions').addEventListener('click', hideInstructions);
            
            // Prevenir zoom con doble toque
            document.addEventListener('dblclick', function(e) {
                e.preventDefault();
            }, { passive: false });
            
            // Iniciar sistema de audio
            initAudio();
        }
        
        // Comenzar el juego
        function startGame() {
            document.getElementById('startScreen').style.display = "none";
            document.getElementById('gamePanel').style.display = "block";
            document.getElementById('timer').style.display = "block";
            
            // Iniciar temporizador
            updateTimerDisplay();
            timerInterval = setInterval(updateTimer, 1000);
            
            // Iniciar sonido de motor
            playEngineSound();
            
            // Mostrar instrucciones del primer reto
            updateInstructions(1);
        }
        
        // Temporizador
        function updateTimer() {
            timeLeft--;
            updateTimerDisplay();
            
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                alert("¡El tiempo se ha agotado! La tormenta de arena ha destruido el laboratorio.");
                document.location.reload();
            }
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Cambiar color cuando quedan 5 minutos
            if (timeLeft <= 5 * 60) {
                document.getElementById('timer').style.color = "#ff0000";
                document.getElementById('timer').style.animation = "pulse 0.5s infinite";
            }
        }
        
        // Reto 1: Ordenar libros - Adaptado para touch
        function setupChallenge1() {
            shuffleBooks();
            const books = document.querySelectorAll('.book');
            const slots = document.querySelectorAll('.shelf-slot');
            
            // Configurar eventos táctiles para libros
            books.forEach(book => {
                book.addEventListener('touchstart', handleBookTouch, { passive: false });
                book.addEventListener('touchend', handleBookRelease, { passive: false });
                book.addEventListener('click', handleBookClick);
            });
            
            // Configurar eventos táctiles para slots
            slots.forEach(slot => {
                slot.addEventListener('touchend', handleSlotTouch, { passive: false });
                slot.addEventListener('click', handleSlotClick);
            });
            
            document.getElementById('checkBooks').addEventListener('click', checkBooksOrder);
            document.getElementById('resetBooks').addEventListener('click', resetBooksToInitial);
        }
        function resetBooksToInitial() {
    const booksToSort = document.getElementById('booksToSort');
    const slots = document.querySelectorAll('.shelf-slot');
    
    // Vaciar todos los slots
    slots.forEach(slot => {
        while (slot.firstChild) {
            booksToSort.appendChild(slot.firstChild);
        }
    });
    
    // Resetear cualquier libro seleccionado
    if (selectedBook) {
        selectedBook.style.transform = "";
        selectedBook.style.zIndex = "";
        selectedBook = null;
    }
    
    // Resetear colores de los slots
    slots.forEach(slot => {
        slot.style.borderColor = "rgba(255, 94, 0, 0.3)";
    });
    
    playRadioSound(); // Sonido de feedback
}

        function handleBookTouch(e) {
            e.preventDefault();
            selectedBook = e.currentTarget;
            selectedBook.style.transform = "scale(1.1)";
            selectedBook.style.zIndex = "10";
        }
        
        function handleBookRelease(e) {
            e.preventDefault();
            if (selectedBook) {
                selectedBook.style.transform = "";
                selectedBook.style.zIndex = "";
            }
        }
        
        function handleBookClick(e) {
            // Manejar doble toque para devolver libro a su posición original
            const now = Date.now();
            if (now - lastTap < 300) {
                // Doble toque - devolver libro a su posición original
                const book = e.currentTarget;
                if (book.parentElement.id !== 'booksToSort') {
                    document.getElementById('booksToSort').appendChild(book);
                }
            }
            lastTap = now;
            
            // Seleccionar libro para colocarlo
            selectedBook = e.currentTarget;
            selectedBook.style.transform = "scale(1.1)";
            selectedBook.style.zIndex = "10";
            
            // Deseleccionar después de un tiempo si no se coloca
            setTimeout(() => {
                if (selectedBook === e.currentTarget) {
                    selectedBook.style.transform = "";
                    selectedBook.style.zIndex = "";
                    selectedBook = null;
                }
            }, 2000);
        }
        
        function handleSlotTouch(e) {
            e.preventDefault();
            if (selectedBook) {
                placeBook(e.currentTarget);
            }
        }
        
        function handleSlotClick(e) {
            if (selectedBook) {
                placeBook(e.currentTarget);
            }
        }
        
        function placeBook(slot) {
            if (!selectedBook) return;
            
            // Si el slot ya tiene un libro, intercambiarlos
            if (slot.firstElementChild) {
                const existingBook = slot.firstElementChild;
                if (selectedBook.parentElement.id === 'booksToSort') {
                    // El libro seleccionado viene de la zona de libros, no hacer intercambio
                    return;
                } else {
                    // Intercambiar libros
                    selectedBook.parentElement.appendChild(existingBook);
                }
            }
            
            slot.appendChild(selectedBook);
            selectedBook.style.transform = "";
            selectedBook.style.zIndex = "";
            selectedBook = null;
        }
        
        function checkBooksOrder() {
            const slots = document.querySelectorAll('.shelf-slot');
            let allCorrect = true;
            
            slots.forEach((slot, index) => {
                const book = slot.firstElementChild;
                
                if (!book || book.dataset.layer !== correctAnswers.books[index]) {
                    allCorrect = false;
                    slot.style.borderColor = "#ff0000";
                } else {
                    slot.style.borderColor = "#00ff00";
                }
            });
            
            if (allCorrect) {
                playSuccessSound();
                showTempCode("VA", "challenge2");
                document.getElementById('codeParts').textContent = codeParts.join(" ");
                setTimeout(() => {
                    document.getElementById('challenge1').classList.remove('active');
                    document.getElementById('challenge2').classList.add('active');
                    currentChallenge = 2;
                    playRadioSound();
                    updateInstructions(2);
                }, 1500);
            } else {
                playExplosionSound();
                setTimeout(() => {
                    slots.forEach(slot => {
                        slot.style.borderColor = "rgba(255, 94, 0, 0.3)";
                    });
                }, 1000);
            }
        }
        
        // Reto 2: Quiz - Adaptado para móvil
        function setupChallenge2() {
            shuffleQuiz();
            document.getElementById('checkQuiz').addEventListener('click', checkQuizAnswers);
        }
        
        function checkQuizAnswers() {
            let allAnswered = true;
            let allCorrect = true;
            const correctAnswers = ["mito", "realidad", "mito", "realidad", "mito", "mito", "realidad", "mito"];

            // Verificar cada pregunta
            for (let i = 1; i <= 8; i++) {
                const selectedOption = document.querySelector(`input[name="q${i}"]:checked`);
                const quizItem = document.querySelector(`input[name="q${i}"]:checked`)?.closest('.quiz-item');
                
                if (!selectedOption) {
                    allAnswered = false;
                    continue;
                }

                // Marcar visualmente
                if (quizItem) {
                    if (selectedOption.value === correctAnswers[i-1]) {
                        // Respuesta correcta - fondo verde oscuro
                        quizItem.style.backgroundColor = "rgba(0, 100, 0, 0.3)";
                        quizItem.style.borderLeft = "5px solid #00ff00";
                    } else {
                        // Respuesta incorrecta - fondo rojo oscuro
                        quizItem.style.backgroundColor = "rgba(100, 0, 0, 0.3)";
                        quizItem.style.borderLeft = "5px solid #ff0000";
                        allCorrect = false;
                    }
                }
            }

            if (!allAnswered) {
                alert("¡Responde todas las preguntas!");
                return;
            }

            if (allCorrect) {
                playSuccessSound();
                showTempCode("LH", "challenge3");
                document.getElementById('codeParts').textContent = codeParts.join(" ");
                setTimeout(() => {
                    document.getElementById('challenge2').classList.remove('active');
                    document.getElementById('challenge3').classList.add('active');
                    currentChallenge = 3;
                    playRadioSound();
                    updateInstructions(3);
                }, 1500);
            } else {
                playExplosionSound();
                alert("¡Algunas respuestas son incorrectas! Revisa los colores de retroalimentación.");
            }
        }
        
        // Reto 3: Hábitos - Adaptado para móvil
        function setupChallenge3() {
            shuffleHabits();
            const habitItems = document.querySelectorAll('.habit-item');
            let currentCarbon = 100;
            updateCarbonMeter(currentCarbon);
            
            // Configurar eventos táctiles para hábitos
            habitItems.forEach(item => {
                item.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    this.classList.toggle('selected');
                    calculateCarbonFootprint();
                }, { passive: false });
                
                item.addEventListener('click', function() {
                    this.classList.toggle('selected');
                    calculateCarbonFootprint();
                });
            });
            
            document.getElementById('checkHabits').addEventListener('click', checkHabitsSelection);
        }
        
        function calculateCarbonFootprint() {
            const selectedHabits = document.querySelectorAll('.habit-item.selected');
            let totalReduction = 0;
            
            selectedHabits.forEach(habit => {
                totalReduction += parseFloat(habit.dataset.impact);
            });
            
            const currentCarbon = 100 + totalReduction;
            const roundedValue = Math.round(currentCarbon * 100) / 100;
            
            updateCarbonMeter(roundedValue);
            return roundedValue;
        }
        
        function updateCarbonMeter(value) {
            const carbonLevel = document.getElementById('carbonLevel');
            const carbonLabel = document.getElementById('carbonLabel');
            
            carbonLabel.textContent = `${value.toFixed(2)} kg CO₂/día`;
            carbonLevel.style.width = `${value}%`;
            
            if (value <= 30.005) {
                carbonLevel.style.background = "linear-gradient(90deg, #00aa00, #00ff00)";
            } else if (value <= 70) {
                carbonLevel.style.background = "linear-gradient(90deg, #ff5e00, #ffcc00)";
            } else {
                carbonLevel.style.background = "linear-gradient(90deg, #ff0000, #ff5e00)";
            }
        }
        
        function checkHabitsSelection() {
            const currentCarbon = calculateCarbonFootprint();
            
            if (currentCarbon <= 30.005) {
                playSuccessSound();
                showTempCode("AL", "challenge4");
                document.getElementById('codeParts').textContent = codeParts.join(" ");
                setTimeout(() => {
                    document.getElementById('challenge3').classList.remove('active');
                    document.getElementById('challenge4').classList.add('active');
                    currentChallenge = 4;
                    playRadioSound();
                    updateInstructions(4);
                }, 1500);
            } else {
                playExplosionSound();
                alert(`¡Aún puedes reducir más! Tu huella debe ser ≤ 30.00 kg CO₂/día (actual: ${currentCarbon.toFixed(2)} kg)`);
            }
        }
        
        // Reto 4: Circuito - Adaptado para móvil
        function setupChallenge4() {
            shuffleEnergySources();
            const energySources = document.querySelectorAll('.energy-source');
            
            energySources.forEach(source => {
                source.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    toggleEnergySource(this);
                }, { passive: false });
                
                source.addEventListener('click', function() {
                    toggleEnergySource(this);
                });
            });
            
            document.getElementById('checkCircuit').addEventListener('click', checkCircuitConfiguration);
        }
        
        function toggleEnergySource(source) {
            source.classList.toggle('active');
            
            const status = source.querySelector('.energy-status');
            if (source.classList.contains('active')) {
                status.textContent = "ACTIVADO";
            } else {
                status.textContent = "DESACTIVADO";
            }
        }
        
        function generateCircuit() {
            const circuitBoard = document.getElementById('circuitBoard');
            const width = circuitBoard.offsetWidth;
            const height = circuitBoard.offsetHeight;
            
            // Crear nodos
            const node1 = document.createElement('div');
            node1.className = 'circuit-node';
            node1.style.left = '20%';
            node1.style.top = '30%';
            circuitBoard.appendChild(node1);
            
            const node2 = document.createElement('div');
            node2.className = 'circuit-node';
            node2.style.left = '50%';
            node2.style.top = '30%';
            circuitBoard.appendChild(node2);
            
            const node3 = document.createElement('div');
            node3.className = 'circuit-node';
            node3.style.left = '80%';
            node3.style.top = '30%';
            circuitBoard.appendChild(node3);
            
            const node4 = document.createElement('div');
            node4.className = 'circuit-node';
            node4.style.left = '20%';
            node4.style.top = '70%';
            circuitBoard.appendChild(node4);
            
            const node5 = document.createElement('div');
            node5.className = 'circuit-node';
            node5.style.left = '50%';
            node5.style.top = '70%';
            circuitBoard.appendChild(node5);
            
            const node6 = document.createElement('div');
            node6.className = 'circuit-node';
            node6.style.left = '80%';
            node6.style.top = '70%';
            circuitBoard.appendChild(node6);
            
            // Crear líneas de conexión
            createLine(node1, node2);
            createLine(node2, node3);
            createLine(node1, node4);
            createLine(node2, node5);
            createLine(node3, node6);
            createLine(node4, node5);
            createLine(node5, node6);
        }
        
        function createLine(node1, node2) {
            const line = document.createElement('div');
            line.className = 'circuit-line';
            
            const x1 = parseFloat(node1.style.left) / 100 * node1.parentElement.offsetWidth;
            const y1 = parseFloat(node1.style.top) / 100 * node1.parentElement.offsetHeight;
            const x2 = parseFloat(node2.style.left) / 100 * node2.parentElement.offsetWidth;
            const y2 = parseFloat(node2.style.top) / 100 * node2.parentElement.offsetHeight;
            
            const length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
            const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
            
            line.style.width = `${length}px`;
            line.style.left = `${x1}px`;
            line.style.top = `${y1}px`;
            line.style.transform = `rotate(${angle}deg)`;
            
            node1.parentElement.appendChild(line);
        }
        
        function checkCircuitConfiguration() {
            const energySources = document.querySelectorAll('.energy-source.active');
            let allCorrect = true;

            // Verificar que solo se activen las fuentes sostenibles
            energySources.forEach(source => {
                if (source.dataset.type !== "sostenible") {
                    allCorrect = false;
                    source.style.borderColor = "#ff0000";
                }
            });
            
            // Verificar que todas las sostenibles estén activadas
            const sustainableSources = document.querySelectorAll('.energy-source[data-type="sostenible"]');
            sustainableSources.forEach(source => {
                if (!source.classList.contains('active')) {
                    allCorrect = false;
                    source.style.borderColor = "#ffff00";
                }
            });
            
            if (allCorrect) {
                playSuccessSound();
                showTempCode("LA", "final");
                document.getElementById('codeParts').textContent = codeParts.join(" ");
                const nodes = document.querySelectorAll('.circuit-node');
                nodes.forEach(node => {
                    node.classList.add('active');
                });

                // Mostrar modal después de 1.5 segundos
                setTimeout(() => {
                    document.getElementById('challenge4').classList.remove('active');
                    document.getElementById('codeModal').style.display = "flex";
                    updateInstructions(5);
                }, 1500);
            } else {
                playExplosionSound();
                setTimeout(() => {
                    document.querySelectorAll('.energy-source').forEach(source => {
                        source.style.borderColor = "";
                    });
                }, 1000);
                alert("¡Configuración incorrecta! Solo deben activarse las fuentes de energía sostenibles y todas ellas deben estar activadas.");
            }
        }
        
        // Código final
        function checkFinalCode() {
            const code = document.getElementById('finalCode').value.toUpperCase();
            
            if (code === "VALHALLA") {
                playSuccessSound();
                document.getElementById('codeModal').style.display = "none";
                document.getElementById('finalScreen').style.display = "flex";
                document.querySelector('.game-panel').style.display = "none";
                document.querySelector('.timer').style.display = "none";
                
                // Detener temporizador
                clearInterval(timerInterval);
             
            } else {
                playExplosionSound();
                alert("¡Código incorrecto! Revisa las pistas obtenidas en cada reto.");
            }
        }
        
        // Sistema de audio
        function initAudio() {
            // Intentar cargar el audio
            sounds.engine = new Audio();
            sounds.engine.src = 'https://raw.githubusercontent.com/chepiramonetx/madmax/main/madmax.mp3';
            sounds.engine.loop = true;
            sounds.engine.volume = 0.3;
            
            // Intentar reproducir (puede ser bloqueado por el navegador)
            const playPromise = sounds.engine.play().catch(e => {
                console.log("Audio bloqueado, mostrando overlay");
                document.getElementById('audioOverlay').style.display = 'block';
            });
        }
        
        function activateAudio() {
            sounds.engine.play()
                .then(() => {
                    document.getElementById('audioOverlay').style.display = 'none';
                })
                .catch(e => {
                    alert("No se pudo iniciar el audio: " + e.message);
                });
        }
        
        function playEngineSound() {
            if (sounds.engine && sounds.engine.paused) {
                sounds.engine.play().catch(e => {
                    console.log("Error al reproducir audio:", e);
                });
            }
        }
        
        function playExplosionSound() {
            // Sonido simple para móviles
            if (sounds.engine) {
                const explosion = new Audio();
                explosion.src = 'https://assets.mixkit.co/sfx/preview/mixkit-explosion-1684.mp3';
                explosion.volume = 0.3;
                explosion.play().catch(e => console.log("Error de sonido:", e));
            }
        }
        
        function playRadioSound() {
            // Sonido simple para móviles
            if (sounds.engine) {
                const radio = new Audio();
                radio.src = 'https://assets.mixkit.co/sfx/preview/mixkit-radio-static-1091.mp3';
                radio.volume = 0.2;
                radio.play().catch(e => console.log("Error de sonido:", e));
            }
        }
        
        function playSuccessSound() {
            // Sonido simple para móviles
            if (sounds.engine) {
                const success = new Audio();
                success.src = 'https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3';
                success.volume = 0.3;
                success.play().catch(e => console.log("Error de sonido:", e));
            }
        }
        
        // Mostrar código temporal
        function showTempCode(code, nextScreen) {
            codeParts.push(code);
            const popup = document.getElementById('codePopup');
            const codeDisplay = document.getElementById('currentCode');
            
            codeDisplay.textContent = code;
            popup.style.display = 'block';
            
            setTimeout(() => {
                popup.style.animation = 'slideIn 0.5s reverse';
                setTimeout(() => {
                    popup.style.display = 'none';
                    popup.style.animation = 'slideIn 0.5s';
                    
                    if (nextScreen === 'final') {
                        document.getElementById('codeParts').textContent = codeParts.join(" ");
                    }
                }, 500);
            }, 3000);
        }
        
        // Mezclar elementos
        function shuffleBooks() {
            const booksContainer = document.getElementById('booksToSort');
            const books = Array.from(booksContainer.children);
            
            for (let i = books.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                booksContainer.appendChild(books[j]);
            }
        }
        
        function shuffleQuiz() {
            const container = document.querySelector('.quiz-container');
            const questions = Array.from(container.children);
            
            questions.sort(() => Math.random() - 0.5);
            questions.forEach(q => container.appendChild(q));
        }
        
        function shuffleHabits() {
            const container = document.querySelector('.habits-container');
            const habits = Array.from(container.children);
            habits.sort(() => Math.random() - 0.5);
            habits.forEach(h => container.appendChild(h));
        }
        
        function shuffleEnergySources() {
            const container = document.querySelector('.circuit-container');
            const sources = Array.from(container.children);
            sources.sort(() => Math.random() - 0.5);
            sources.forEach(s => container.appendChild(s));
        }
        
        // Sistema de instrucciones
        function showInstructions() {
            document.getElementById('instructionsPanel').style.display = 'block';
        }
        
        function hideInstructions() {
            document.getElementById('instructionsPanel').style.display = 'none';
        }
        
        function updateInstructions(challenge) {
            const title = document.getElementById('instructionsTitle');
            const text = document.getElementById('instructionsText');
            
            switch(challenge) {
                case 1:
                    title.textContent = "ARCHIVOS ATMOSFÉRICOS";
                    text.innerHTML = `
                        <p><strong>Objetivo:</strong> Ordena los libros según las capas de la atmósfera, de más cercana a más lejana de la superficie terrestre.</p>
                        <p><strong>Orden correcto:</strong> Troposfera → Estratosfera → Mesosfera → Termosfera → Exosfera</p>
                        <p><strong>Cómo jugar:</strong></p>
                        <ul>
                            <li>Toca un libro para seleccionarlo (se resaltará)</li>
                            <li>Toca el estante donde quieres colocarlo</li>
                            <li>Doble toque en un libro para devolverlo a su lugar original</li>
                        </ul>
                    `;
                    break;
                case 2:
                    title.textContent = "MITOS DEL WASTELAND";
                    text.innerHTML = `
                        <p><strong>Objetivo:</strong> Identifica qué afirmaciones son realidades científicas sobre el cambio climático y cuáles son mitos.</p>
                        <p><strong>Cómo jugar:</strong></p>
                        <ul>
                            <li>Lee cada afirmación cuidadosamente</li>
                            <li>Selecciona "Mito" o "Realidad" según tu conocimiento</li>
                            <li>Las respuestas correctas se marcarán en verde, las incorrectas en rojo</li>
                        </ul>
                    `;
                    break;
                case 3:
                    title.textContent = "EL LIBRO DE LOS HÁBITOS";
                    text.innerHTML = `
                        <p><strong>Objetivo:</strong> Selecciona los hábitos sostenibles para reducir la huella de carbono por debajo de 30 kg/día.</p>
                        <p><strong>Cómo jugar:</strong></p>
                        <ul>
                            <li>Cada hábito muestra su impacto en kg de CO₂</li>
                            <li>Selecciona los hábitos sostenibles (impacto negativo)</li>
                            <li>Evita los hábitos contaminantes (impacto positivo)</li>
                            <li>La barra de CO₂ muestra tu progreso en tiempo real</li>
                        </ul>
                    `;
                    break;
                case 4:
                    title.textContent = "EL CIRCUITO DE FURIOSA";
                    text.innerHTML = `
                        <p><strong>Objetivo:</strong> Conecta solo las fuentes de energía sostenibles para activar el sistema.</p>
                        <p><strong>Fuentes sostenibles:</strong></p>
                        <ul>
                            <li>Panel Solar (☀️)</li>
                            <li>Turbina Eólica (🌬️)</li>
                            <li>Energía Hidroeléctrica (💧)</li>
                            <li>Energía Geotérmica (🌋)</li>
                            <li>Mareomotriz (🌊)</li>
                        </ul>
                        <p><strong>Cómo jugar:</strong> Toca cada fuente de energía para activarla/desactivarla.</p>
                    `;
                    break;
                case 5:
                    title.textContent = "CÓDIGO FINAL";
                    text.innerHTML = `
                        <p><strong>¡Felicidades!</strong> Has reunido todas las partes del código.</p>
                        <p>Las pistas obtenidas son: <strong>${codeParts.join(" ")}</strong></p>
                        <p><strong>Código final:</strong> Introduce la palabra clave formada por las pistas para activar el dispositivo del Dr. Atmos.</p>
                        <p><strong>Consejo:</strong> Piensa en el tema central del juego y las iniciales de las pistas.</p>
                    `;
                    break;
                default:
                    title.textContent = "INSTRUCCIONES GENERALES";
                    text.innerHTML = `
                        <p>Bienvenido a Mad Max: Apocalipsis Climático. Tu misión es completar los 4 retos para obtener el código final y salvar el mundo.</p>
                        <p>Cada reto te dará una parte del código. Al completar los 4 retos, podrás introducir el código final.</p>
                        <p><strong>Temporizador:</strong> ¡Tienes 30 minutos para completar la misión!</p>
                    `;
            }
        }
        
        // Iniciar el juego cuando se cargue la página
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>